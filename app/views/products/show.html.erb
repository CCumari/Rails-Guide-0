
<% cache @product do %>

<section class="product">
    <div class="product-image-container">
        <%= image_tag @product.featured_image if @product.featured_image.attached? %>
    </div>
    <section class="product-info">
        <h1><%= @product.name %></h1>
        <%= @product.description %>
        <%= render "inventory", product: @product %>

        <% end %>

        <p><%= link_to "Back", products_path %></p>
        <% if authenticated? %>
        <%= link_to "Edit", edit_product_path(@product) %>
        <%= button_to "Delete", @product, method: :delete, data: { turbo_confirm: "Are you sure?" } %>
        <% end %>
    </section>

    <h2>Reviews</h2>

<div id="reviews-list">
  <% if @product.reviews.any? %>
    <% @product.reviews.includes(:user).each do |review| %>
      <div class="review">
        <div class="review-header">
      
        
        <div class="review-content"><%= review.comment %></div>
        
        <div class="review-rating">
          <% review.rating.times do %>
            <span class="star">★</span>
          <% end %>
          <% (5 - review.rating).times do %>
            <span class="star" style="color: #dbdbdb;">★</span>
          <% end %>
          <span style="margin-left: 5px;"><%= review.rating %> out of 5</span>
        </div>
        
        <div class="review-date">
          <%= time_ago_in_words(review.created_at) %> ago
        </div>
        
        <% if review.user == Current.user %>
          <div class="review-actions">
            <%= link_to 'Delete this review', product_review_path(@product, review), 
                method: :delete, 
                data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this review?" } %>
          </div>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <div class="no-reviews-message">
      No reviews yet. Be the first to review this product!
    </div>
  <% end %>
</div>

<div class="review-form-container">
  <div class="review-form-header">
    Add a Review
  </div>
  
  <% if authenticated? %>
    <div class="review-form">
      <%= form_with model: [@product, Review.new], local: true do |f| %>
        <div class="review-form-field">
          <%= f.label :rating, "Your Rating (1-5 stars)" %>
          <%= f.number_field :rating, in: 1..5, class: "rating-input" %>
        </div>
        <div class="review-form-field">
          <%= f.label :comment, "Your Review" %>
          <%= f.text_area :comment, placeholder: "Share your thoughts about this product..." %>
        </div>
        <div>
          <%= f.submit "Post Review", class: "review-form-submit" %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="review-form">
        <p>Please <%= link_to "log in", new_session_path %> to add a review.</p>
    </div>
  <% end %>
</div>

</section>
